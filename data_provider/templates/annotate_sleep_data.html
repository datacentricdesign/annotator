{% extends 'base_generic.html' %}
{% load static %}

{% block header %}
<h1>Data Annotation</h1>
{% endblock %}


{% block content %}

<img style="width:280px; padding-right: 20px; padding-top:20px;position:absolute;"
  src="/download_sleep_data/{{ prolific_id }}">

<form action="" method="post">
  {% csrf_token %}
  <p style="margin-left: 325px;">
    This task aims at understanding your sleep experiences. {{intro_sentence}}
    The following questions lead you to reflect on <b>your sleep and elaborate on your sleep experience</b> through an
    exploration of this sleep data.
  </p>

  <div style="margin-left: 300px;height: 480px;overflow-y: scroll;">

    <ol>
      <li>
        Have a look at the <it>Sleep Goal</it>, <it>Average Time in Bed</it> and <it>Average Time Asleep</it>in the
        screenshot. Calculate the time difference between the goal and the averages. Then, answer the following
        questions.
        <ul>
          <li>
            Relating to <b>your</b> daily routine and energy level, describe what triggers you. For instance, is there
            any information that you find surprising or encouraging?
            <textarea rows="5" id="id_question1" name="question1" required="required"></textarea>
          </li>
          <li>
            Why does this information trigger you? Please relate to <b>your</b> sleep experience and tell us more.
            <textarea rows="5" id="id_question2" name="question2" required="required"></textarea>
          </li>
        </ul>
      </li>

      <li>
        Have a look at the sleep trend and pattern in the bar chart and answer the following questions.
        <ul>
          <li>
            Relating to <b>your</b> sleep habit and body condition, describe what triggers you. For instance, is there
            any information that you find surprising or encouraging?
            <textarea rows="5" id="id_question3" name="question3" required="required"></textarea>
          </li>
          <li>
            Why does this information trigger you? Please relate to your sleep experience and tell us more.
            <textarea rows="5" id="id_question4" name="question4" required="required"></textarea>
          </li>
        </ul>
      </li>

      <li>
        Have a look at the latest sleep time and earliest wake-up time in the bar chart and answer the following
        questions.
        <ul>
          <li>
            Over the past months, did you go to sleep at this latest sleep time or earliest wake-up time? If you did,
            what were the reasons for going late to bed or waking up early on that day(s)? If you didn't, please tell us
            why you do not sleep or wake up at these times?
            <textarea rows="5" id="id_question5" name="question5" required="required"></textarea>
          </li>
          <li>
            Across all information visible on this screenshot, describe what triggers you. For instance, is there any
            information that you find surprising or encouraging?
            <textarea rows="5" id="id_question6" name="question6" required="required"></textarea>
          </li>
          <li>
            Why does this information trigger you? Please relate to <b>your</b> sleep experience and tell us more.
            <textarea rows="5" id="id_question7" name="question7" required="required"></textarea>
          </li>
        </ul>
      </li>
    </ol>

  </div>

  <div style="float: right;margin-top:10px">
    <input class="button" id="next" type="submit" value="Next" disabled="true">
  </div>

</form>

<script>
  words = {
    "id_question1": 0,
    "id_question2": 0,
    "id_question3": 0,
    "id_question4": 0,
    "id_question5": 0,
    "id_question6": 0,
    "id_question7": 0,
  }
  function countWord(event) {
    let res = [];
    let str = event.target.value.replace(/[\t\n\r\.\?\!]/gm, " ").split(" ");
    str.map((s) => {
      let trimStr = s.trim();
      if (trimStr.length > 0) {
        res.push(trimStr);
      }
    });
    words[event.target.id] = res.length;
    enoughWords = true;
    for (const key in words) {
      if (words[key] < 40) {
        enoughWords = false
      }
    }
    if (enoughWords == true) {
      document.getElementById("next").disabled = false;
      console.log('enough words!!')
    }
  }

  window.document.querySelector("#id_question1")
    .addEventListener("input", countWord);
  window.document.querySelector("#id_question2")
    .addEventListener("input", countWord);
  window.document.querySelector("#id_question3")
    .addEventListener("input", countWord);
  window.document.querySelector("#id_question4")
    .addEventListener("input", countWord);
  window.document.querySelector("#id_question5")
    .addEventListener("input", countWord);
  window.document.querySelector("#id_question6")
    .addEventListener("input", countWord);
  window.document.querySelector("#id_question7")
    .addEventListener("input", countWord);
</script>

{% endblock %}